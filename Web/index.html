<!DOCTYPE html>
<html>
<head>
	<title>Station m&eacute;t&eacute;o | Param&egrave;tres</title>
    <link href='https://metroui.org.ua/css/metro.css' rel='stylesheet'>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>
	<style>
	body {
		text-align: center;
	}
	ul li, ol li {
		background: white;
		color: gray;
		width: 20%;
	    list-style-type: none;
		height: 25px;
		text-align: center;
	}
	</style>
</head>
<body class='bg-black'>
	
<form>
	
	<div class='grid'>
		<div class='row'>
			<div class='cell sub-header fg-grayLight'>
				Station m&eacute;t&eacute;o
			</div>
		</div>
		
		<div class='row'>
			<div class='cell leader fg-grayLighter'>
				<h1>Param&egrave;tres</h1>
			</div>
		</div>
		
		<div class='row'>
			<div class='cell'>
				<div class='input-control text fg-grayLight'>
					<label for='api_key'>Cl&eacute; API</label>
					<input type='text' name='api_key' />
				</div>
			</div>
		</div>
		
		<div class='row'>
			<div class='cell'>
				<div class='input-control text fg-grayLight'>
					<label for='city'>Ville</label>
					<input type='text' id='city' name='city' />
					<input type='hidden' id='city_code' name='city_code' />
				</div>
			</div>
		</div>
		
		<div class='row'>
			<div class='cell'>
				<div class='input-control select fg-grayLight'>
					<label for='utc_offset'>D&eacute;calage horaire</label>
					<select name='utc_offset'>
						<option value='-12'>-12</option>
						<option value='-11'>-11</option>
						<option value='-10'>-10</option>
						<option value='-9'>-9</option>
						<option value='-8'>-8</option>
						<option value='-7'>-7</option>
						<option value='-6'>-6</option>
						<option value='-5'>-5</option>
						<option value='-4'>-4</option>
						<option value='-3'>-3</option>
						<option value='-2'>-2</option>
						<option value='-1'>-1</option>
						<option value='0'>0</option>
						<option value='1'>1</option>
						<option value='2'>2</option>
						<option value='3'>3</option>
						<option value='4'>4</option>
						<option value='5'>5</option>
						<option value='6'>6</option>
						<option value='7'>7</option>
						<option value='8'>8</option>
						<option value='9'>9</option>
						<option value='10'>10</option>
						<option value='11'>11</option>
						<option value='12'>12</option>
						<option value='13'>13</option>
						<option value='14'>14</option>
					</select>
				</div>
			</div>
		</div>
		
		<div class='row'>
			<div class='cell'>
				<div class='input-control select fg-grayLight'>
					<label for='temperature'>Temp&eacute;rature</label>
					<select name='temperature'>
						<option value='C'>&#8451;</option>
						<option value='F'>&#8457;</option>
					</select>
				</div>
			</div>
		</div>
		
		<div class='row'>
			<div class='cell'>
				<div class='input-control text'>
					<input class='fg-white border-white bg-black' type='submit' name='submit' value='Enregistrer' />
				</div>
			</div>
		</div>
	</div>
</form>

<script>
/* Call getAutoCompleteValues function when user types on City field */
jQuery(document).ready(function($) {

  $('#city').keyup(function() {
    getAutoCompleteValues($('#city').val());
  });

});

/* JQuery autocomplete override to show city name to user and hide/store city code */
$.widget( 'ui.autocomplete', $.ui.autocomplete, {
    options: {
        select: function(event, ui) {
			$('#city').val(ui.item.label);
			$('#city_code').val(ui.item.value);
			return false;
        }
    }
});

/* Retrieve and autocomplete City field from Wunderground API */
function getAutoCompleteValues(val) {

  $.ajax({
    dataType: 'jsonp',
    jsonp: 'cb',
    cache: 'false',
    url: 'http://autocomplete.wunderground.com/aq?query=' + val + '&format=json',
    cache: false,
    success: function(data) {

	var availableCities = [];

	if (val == '') {
		availableCities = [];
	}
	else {
		for (i in data.RESULTS) {
		  var city = data.RESULTS[i]['name'];
		  var cityCode = data.RESULTS[i]['l'];
		  
		  availableCities.push({ label: city, value: cityCode });
		}
	}
	
	console.log(availableCities);
	
	$( '#city' ).autocomplete({
		source: availableCities
	});
    }
  });
}
</script>

</body>
</html>